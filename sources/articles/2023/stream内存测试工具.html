<!DOCTYPE html>
<html>

<head>
    <title>phpipam搭建</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.css" />
    <link rel="stylesheet" href="../../css/home_style.css">
    <link rel="stylesheet" href="../../css/index_style.css">
</head>

<body>
    <div class="container-fluid">
        <div class="row" id="head">
            <div class="col" id="logo">
                <a href="../home.html">
                    <img src="../../img/logo.png" alt="">
                    <span>陈可微</span>
                </a>
            </div>

            <div class="col" id="navigation">
                <a href="../archive.html">
                    <span>归档</span>
                </a>
                <a href="tags.html">
                    <span>标签</span>
                </a>
                <a href="">
                    <span>订阅</span>
                </a>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col">
                <p>phpipam搭建</p>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <img src="../../img/logo.png" alt="">
                <span>陈可微</span>
                <span class="body_articles_tag"><a href="">[phpipam]</a></span>
            </div>
        </div>
    </div>
    <div class="container">
        <img src="" alt="">
    </div>
    <div class="container">
        <h3>手动部署phpipam</h3>

<p><strong>前置:无Apache，MySQL，php</strong>
<strong>禁用SELINUX，重启服务器</strong></p>

<pre><code class="language-bash">sed -i '/SELINUX/s/enforcing/disabled/' /etc/selinux/config &amp;&amp; reboot
</code></pre>

<p><strong>关闭防火墙</strong></p>

<pre><code class="language-bash">systemctl stop firewalld
</code></pre>

<p><strong>安装依赖包</strong></p>

<pre><code class="language-bash">yum install epel-release -y
yum install wget vim net-tools httpd mariadb-server 
php php-cli php-gd php-common php-ldap php-pdo php-pear
php-snmp php-xml php-mysql php-mbstring git -y
</code></pre>

<h3>初始化Apache</h3>

<p><strong>修改/etc/httpd/conf/httpd.conf</strong></p>

<pre><code class="language-yaml">ServerName localhost:80
</code></pre>

<p><strong>允许mod_rewrite URL重写</strong></p>

<pre><code class="language-yaml">&lt;Directory &quot;/var/www/html&quot;&gt;
 Options FollowSymLinks
 AllowOverride all
 Order allow,deny
 Allow from all
&lt;/Directory&gt;
</code></pre>

<p><strong>检查配置文件，显示 OK 状态为正常</strong></p>

<pre><code class="language-yaml">httpd -t -f /etc/httpd/conf/httpd.conf
</code></pre>

<p><strong>修改/etc/php.ini时区</strong></p>

<pre><code class="language-yaml">date.timezone = Asia/Shanghai
</code></pre>

<p><strong>开机启动Apache</strong></p>

<pre><code class="language-bash">systemctl enable httpd
</code></pre>

<p><strong>启动Apache</strong></p>

<pre><code class="language-bash">systemctl start httpd
</code></pre>

<h3>初始化mariadb</h3>

<p><strong>开机启动mariadb</strong></p>

<pre><code class="language-bash">systemctl enable mariadb
</code></pre>

<p><strong>启动mariadb</strong></p>

<pre><code class="language-bash">systemctl start mariadb
</code></pre>

<p><strong>初始化mariaDB密码</strong></p>

<pre><code class="language-bash">mysql_secure_installation
</code></pre>

<h3>初始化phpipam</h3>

<p><strong>下载phpipam</strong></p>

<pre><code class="language-bash">cd /var/www/html/
git clone https://github.com/phpipam/phpipam.git .
git checkout 1.4
</code></pre>

<p><strong>权限配置</strong></p>

<pre><code class="language-bash">chown apache:apache -R /var/www/html/
</code></pre>

<p><strong>拷贝文件</strong></p>

<pre><code class="language-bash">cp /var/www/html/config.dist.php /var/www/html/config.dist.php.bak
mv /var/www/html/config.dist.php /var/www/html/config.php
</code></pre>

<p><strong>编辑/var/www/html/config.php</strong></p>

<pre><code class="language-yaml">define('BASE', &quot;/phpipam&quot;); 
</code></pre>

<p><strong>重启httpd</strong></p>

<pre><code class="language-bash">systemctl restart httpd
</code></pre>

<h3>docker部署phpipam</h3>

<pre><code class="language-bash">vi docker-compose.yml
#添加配置
</code></pre>

<blockquote>
<pre><code class="language-bash">&gt; # WARNING: Replace the example passwords with secure secrets.
&gt; # WARNING: 'my_secret_phpipam_pass' and 'my_secret_mysql_root_pass'
&gt;
&gt; version: '3'
&gt;
&gt; services:
&gt;   phpipam-web:
&gt;     privileged: true ---特级权限
&gt;     image: phpipam/phpipam-www:latest
&gt;     ports: ---添加一条映射到本地端口
&gt;       - &quot;64080:80&quot;
&gt;     environment:
&gt;       - TZ=Asia/Shanghai
&gt;       - IPAM_DATABASE_HOST=phpipam-mariadb
&gt;       - IPAM_DATABASE_PASS=password ---修改密码
&gt;       - IPAM_DATABASE_WEBHOST=%
&gt;     restart: unless-stopped
&gt;     volumes:
&gt;       - phpipam-logo:/phpipam/css/images/logo
&gt;     depends_on:
&gt;       - phpipam-mariadb
&gt;
&gt;   phpipam-cron:
&gt;     privileged: true ---特级权限
&gt;     image: phpipam/phpipam-cron:latest
&gt;     environment:
&gt;       - TZ=Asia/Shanghai
&gt;       - IPAM_DATABASE_HOST=phpipam-mariadb
&gt;       - IPAM_DATABASE_PASS=password ---修改密码
&gt;       - SCAN_INTERVAL=1h
&gt;     restart: unless-stopped
&gt;     depends_on:
&gt;       - phpipam-mariadb
&gt;
&gt;   phpipam-mariadb:
&gt;     privileged: true ---特级权限
&gt;     image: mariadb:latest
&gt;     ports: ---mysql端口映射
&gt;       - &quot;3306:3306&quot; 
&gt;     environment:
&gt;       - MYSQL_ROOT_PASSWORD=password ---修改mysql密码
&gt;     restart: unless-stopped
&gt;     command: ---添加command 设置拉取的mysql镜像支持中文
&gt;       - mysqld
&gt;       - --character-set-server=utf8mb4
&gt;       - --collation-server=utf8mb4_unicode_ci
&gt;     volumes: ---容器内数据文件存放路径
&gt;       - phpipam-db-data:/var/lib/mysql
&gt; 
&gt; volumes: ---通过卷标将数据持久化
&gt;   phpipam-db-data:
&gt;   phpipam-logo:
&gt; ```

**运行容器**
</code></pre>

<p>bash
docker-compose up -d
```</p>
</blockquote>

<h3>配置phpipam</h3>

<p><strong>打开地址：<a href="http://IP/phpipam">http://IP/phpipam</a></strong>
<strong>选择新的phpipam安装</strong>
<img src="img/phpipam/1.png" alt="img" />
<strong>安装pfpipam数据库</strong>
<img src="img/phpipam/2.png" alt="img" />
<strong>设置数据库</strong>
<img src="img/phpipam/3.png" alt="img" />
<img src="img/phpipam/4.png" alt="img" />
<strong>填写系统信息</strong>
<img src="img/phpipam/5.png" alt="img" />
<img src="img/phpipam/6.png" alt="img" />
<strong>登录</strong>
<img src="img/phpipam/7.png" alt="img" />
<img src="img/phpipam/8.png" alt="img" />
<strong>登录成功后会跳转到主界面</strong>
<img src="img/phpipam/9.png" alt="img" />
<strong>修改语言为中文，修改后重新登陆</strong>
<img src="img/phpipam/10.png" alt="img" />
<img src="img/phpipam/11.png" alt="img" />
<img src="img/phpipam/12.png" alt="img" />
<strong>子网创建，删除默认测试子网</strong>
<img src="img/phpipam/13.png" alt="img" />
<img src="img/phpipam/14.png" alt="img" />
<img src="img/phpipam/15.png" alt="img" />
<img src="img/phpipam/16.png" alt="img" />
<strong>子网页面</strong>
<img src="img/phpipam/17.png" alt="img" />
<strong>选中IP进行编辑</strong>
<img src="img/phpipam/18.png" alt="img" /></p>

    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.2/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script>
    window.onload = function () {
        Prism.highlightAll();
    }
</script>